server {
    listen  0.0.0.0:80;
    listen  [::]:80;
    server_name  localhost;
    root   /var/www/public;
    index  index.html index.php;

    #charset koi8-r;
    #access_log  /var/log/nginx/host.access.log  main;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }

    location /git {

        # auth_basic            "Restricted";
        # auth_basic_user_file  /var/lib/git/htpasswd;

        access_log  /var/log/nginx/git_access.log  main;
        error_log   /var/log/nginx/git_error.log;

        proxy_read_timeout    300;
        proxy_connect_timeout 300;
        proxy_redirect        off;

        fastcgi_split_path_info ^(/git)(/[^/]+\.git/.*);

        fastcgi_pass unix:/var/run/fcgiwrap.socket;

        fastcgi_param SCRIPT_FILENAME /usr/lib/git-core/git-http-backend;
        fastcgi_param GIT_PROJECT_ROOT /var/www/storage/app/repositories;
        fastcgi_param GIT_HTTP_EXPORT_ALL "";
        fastcgi_param PATH_INFO $fastcgi_path_info;
        include fastcgi_params;
    }


    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass php:9000;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }

}